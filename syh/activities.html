<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>æ´»å‹•è³‡è¨Šï½œæ–°ç¾©å’Œæ­ŒåŠ‡åœ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="æœ€æ–°æ´»å‹•ã€æ´»å‹•ç´€éŒ„èˆ‡ä½œå“é›†ï¼Œä¸€é æŒæ¡æ¼”å‡ºè³‡è¨Šã€å ±åé€£çµèˆ‡ç²¾å½©å›é¡§ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="activities.css">
  <link rel="icon" href="favicon.ico">
</head>
<body>
  <!-- é é¦– / æ¬¡ç´šå°è¦½ -->
  <header class="site-header">
    <div class="container head-wrap">
      <a class="brand" href="home.html" aria-label="å›åˆ°é¦–é ">æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜</a>
      <nav class="subnav" aria-label="æ´»å‹•é å°è¦½">
        <a class="subnav-link" href="home.html">é¦–é </a>
        <a class="subnav-link" href="#latest" data-tab="latest" aria-current="page">æœ€æ–°æ´»å‹•</a>
        <a class="subnav-link" href="#history" data-tab="history">æ´»å‹•ç´€éŒ„</a>
        <a class="subnav-link" href="#portfolio" data-tab="portfolio">ä½œå“é›†</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1>æ´»å‹•è³‡è¨Š</h1>
      <p class="hero-sub">ğŸ“£ è¿½è¹¤å³å°‡ä¸Šæ¼”çš„ç¯€ç›®ã€å›é¡§æ­·ä¾†æ¼”å‡ºèˆ‡ç²¾é¸ä½œå“ã€‚</p>
      <div class="filters">
        <label class="sr-only" for="search">æœå°‹æ´»å‹•</label>
        <input id="search" class="search" type="search" placeholder="æœå°‹é—œéµå­—ï¼ˆæ¨™é¡Œã€åœ°é»ã€æ¨™ç±¤ï¼‰â€¦" />
        <select id="tagFilter" class="tag-filter" aria-label="ä¾æ¨™ç±¤ç¯©é¸">
          <option value="">å…¨éƒ¨æ¨™ç±¤</option>
        </select>
      </div>
    </div>
  </section>

  <!-- åˆ†é å…§å®¹ -->
  <main class="container">
    <section id="panel-latest" class="panel" role="region" aria-labelledby="tab-latest">
      <h2 id="tab-latest" class="panel-title">æœ€æ–°æ´»å‹•</h2>
      <div id="latestList" class="card-grid" aria-live="polite"></div>
      <div class="empty" id="latestEmpty" hidden>ç›®å‰æ²’æœ‰å³å°‡èˆ‰è¾¦çš„æ´»å‹•ï¼Œæ•¬è«‹æœŸå¾…ï¼</div>
    </section>

    <section id="panel-history" class="panel" role="region" aria-labelledby="tab-history" hidden>
      <h2 id="tab-history" class="panel-title">æ´»å‹•ç´€éŒ„</h2>
      <div id="historyList" class="timeline" aria-live="polite"></div>
      <div class="empty" id="historyEmpty" hidden>å°šç„¡æ´»å‹•ç´€éŒ„ã€‚</div>
    </section>

    <section id="panel-portfolio" class="panel" role="region" aria-labelledby="tab-portfolio" hidden>
      <h2 id="tab-portfolio" class="panel-title">ä½œå“é›†</h2>
      <div id="portfolioList" class="masonry" aria-live="polite"></div>
      <div class="empty" id="portfolioEmpty" hidden>å°šæœªå»ºç«‹ä½œå“é›†é …ç›®ã€‚</div>
    </section>
  </main>

  <!-- æ´»å‹•è©³æƒ… Modal -->
  <dialog id="eventDialog" class="event-dialog" aria-label="æ´»å‹•è©³æƒ…">
    <form method="dialog">
      <button class="close" aria-label="é—œé–‰">âœ•</button>
    </form>
    <div class="dialog-body" id="dialogBody"></div>
  </dialog>

  <footer class="site-footer">
    <div class="container">
      <small>Â© <span id="year"></span> æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜ï½œAll Rights Reserved.</small>
    </div>
  </footer>

  <!-- ======== JSï¼ˆåˆä½µåœ¨ HTMLï¼‰======== -->
  <script>
    /* ============== 0) ç¯„ä¾‹è³‡æ–™ï¼ˆå…ˆé€™æ¨£æ”¾ï¼Œä¹‹å¾Œæ›æˆä½ çš„çœŸå¯¦è³‡æ–™ï¼‰ ============== */
    const events = [
      {
        id: "e-2025-09-20",
        title: "ã€ŠèŠ±ç‡ˆå…­ç™¾è­·åœ‹å°‡è»ã€‹â€” å½°åŒ–å ´",
        dateStart: "2025-09-20T19:00:00+08:00",
        dateEnd:   "2025-09-20T21:30:00+08:00",
        location: "å½°åŒ–æ¼”è—å»³",
        city: "å½°åŒ–å¸‚",
        cover: "https://picsum.photos/seed/hl600/800/500",
        tags: ["æ­Œä»”æˆ²","ç¾å ´æ¼”å‡º"],
        summary: "ç¶“å…¸é‰…ä½œå·¡æ¼”ï¼Œé¦–æ¬¡æ–¼å½°åŒ–ç™»å ´ï¼",
        ticketUrl: "https://example.com/tickets",
        type: "upcoming"
      },
      {
        id: "e-2025-10-12",
        title: "å‚³çµ±æŒä¸­æˆ² â€” ã€Œå°‡æ°´ã€å°ˆå ´",
        dateStart: "2025-10-12T14:30:00+08:00",
        location: "è‡ºä¸­åœ‹å®¶æ­ŒåŠ‡é™¢å°åŠ‡å ´",
        city: "è‡ºä¸­å¸‚",
        cover: "https://picsum.photos/seed/jiangshui/800/500",
        tags: ["å¸ƒè¢‹æˆ²","æ›²ç‰Œ","è¦ªå­å‹å–„"],
        summary: "ä»¥æ›²ç‰Œã€ˆå°‡æ°´ã€‰ç‚ºè»¸ï¼Œå±•ç¾æŒä¸­æˆ²èº«æ®µèˆ‡éŸ³æ¨‚ã€‚",
        ticketUrl: "",
        type: "upcoming"
      },
      {
        id: "h-2024-12-25",
        title: "ã€Šé¾åŸçˆ­éœ¸ã€‹â€” é›²æ—å ´",
        dateStart: "2024-12-25T19:30:00+08:00",
        location: "é›²æ—è¡¨æ¼”è—è¡“ä¸­å¿ƒ",
        city: "é›²æ—ç¸£",
        cover: "https://picsum.photos/seed/longcheng/800/500",
        tags: ["æ­Œä»”æˆ²","å·¡æ¼”"],
        summary: "èåˆå‚³çµ±èˆ‡ç¾ä»£èˆå°æŠ€è¡“çš„å…¨æ–°æ¼”ç¹¹ã€‚",
        gallery: ["https://picsum.photos/seed/a1/1200/800","https://picsum.photos/seed/a2/1200/800"],
        type: "past"
      },
      {
        id: "h-2024-04-28",
        title: "ã€Šå…«ä»™å‚³å¥‡ã€‹â€” é«˜é›„å ´",
        dateStart: "2024-04-28T19:00:00+08:00",
        location: "è¡›æ­¦ç‡Ÿè¡¨æ¼”å»³",
        city: "é«˜é›„å¸‚",
        cover: "https://picsum.photos/seed/baxian/800/500",
        tags: ["æ­Œä»”æˆ²","ç¶“å…¸"],
        summary: "ç¶“å…¸å…«ä»™æ•…äº‹ï¼Œèåˆç¾ä»£ç‡ˆå…‰èˆ‡å¤šåª’é«”èˆå°ã€‚",
        type: "past"
      },
      {
        id: "p-ig-luwenlong",
        title: "ç¶“å…¸é›»è¦–æ­Œä»”æˆ²ã€Šé™¸æ–‡é¾ã€‹æˆ²ä¸­æ›²èª¿",
        dateStart: "2025-08-18",           // æƒ³æ’åºé å‰å°±å¡«ä»Šå¤©æˆ–æœ€è¿‘æ—¥æœŸï¼›ä¸å¡«ä¹Ÿå¯
        location: "Instagram Reels",
        city: "ç·šä¸Š",
        cover: "https://picsum.photos/seed/luwenlong/800/500", // å»ºè­°æ›æˆä½ è‡ªå·±çš„å°é¢åœ–ç¶²å€
        tags: ["ä½œå“é›†", "èŠ±çµ®", "æ­Œä»”æˆ²"],
        summary: "ç‰‡æ®µèŠ±çµ®ï¼šç¶“å…¸é›»è¦–æ­Œä»”æˆ²ã€Šé™¸æ–‡é¾ã€‹ä¸­çš„æ›²èª¿ç¯€é¸ã€‚",
        videoUrl: "https://www.instagram.com/reel/DNahemuyJDC/?igsh=ODhwNGhtZms0dHQ4",
        type: "portfolio"
      }
    ];

    /* ============== 1) å°å·¥å…· ============== */
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const safeTime = (iso) => {
      if (!iso) return NaN;
      const t = Date.parse(iso);
      return Number.isFinite(t) ? t : NaN;
    };
    const formatDate = (iso) => {
      if (!iso) return "æ—¥æœŸæœªå®š";
      const t = safeTime(iso);
      if (!Number.isFinite(t)) return iso; // ä¿ç•™ä½ åŸæœ¬å¡«çš„å­—ä¸²
      const d = new Date(t);
      const Y = d.getFullYear();
      const M = String(d.getMonth()+1).padStart(2,'0');
      const D = String(d.getDate()).padStart(2,'0');
      const h = String(d.getHours()).padStart(2,'0');
      const m = String(d.getMinutes()).padStart(2,'0');
      return `${Y}-${M}-${D}${(h+m!=="0000") ? ` ${h}:${m}` : ""}`;
    };

    function createTagChips(tags = []) {
      return tags.map(t => `<span class="chip" data-chip="${t}">${t}</span>`).join("");
    }

    function populateTagFilter() {
      const set = new Set();
      events.forEach(e => (e.tags || []).forEach(t => set.add(t)));
      const sel = $("#tagFilter");
      [...set].sort().forEach(tag => {
        const opt = document.createElement("option");
        opt.value = tag; opt.textContent = tag;
        sel.appendChild(opt);
      });
    }

    /* ============== 2) HTML ç”Ÿæˆï¼ˆå¡ç‰‡/æ™‚é–“è»¸/ä½œå“é›†ï¼‰ ============== */
    function cardHTML(e){
      return `
      <article class="card" tabindex="0" aria-label="${e.title}">
        <img loading="lazy" src="${e.cover || ''}" alt="${e.title}">
        <div class="card-body">
          <h3 class="card-title">${e.title}</h3>
          <p class="card-meta">ğŸ—“ ${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}</p>
          <p class="card-meta">ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
          <p class="card-desc">${e.summary || ""}</p>
          <div class="card-tags">${createTagChips(e.tags || [])}</div>
          <div class="card-actions">
            ${e.ticketUrl ? `<a class="btn primary" href="${e.ticketUrl}" target="_blank" rel="noopener">ç«‹å³å ±å</a>` : ""}
            <button class="btn ghost" data-detail="${e.id}">çœ‹è©³æƒ…</button>
          </div>
        </div>
      </article>`;
    }

    function timelineHTML(e){
      return `
      <div class="time-item">
        <div class="time-dot" aria-hidden="true"></div>
        <div class="time-content">
          <time class="time-date">${formatDate(e.dateStart)}</time>
          <h3 class="time-title">${e.title}</h3>
          <p class="time-meta">ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
          <div class="time-tags">${createTagChips(e.tags || [])}</div>
          <div class="time-actions">
            <button class="btn ghost" data-detail="${e.id}">çœ‹å›é¡§</button>
          </div>
        </div>
      </div>`;
    }

    function portfolioHTML(e){
      return `
      <figure class="masonry-item" tabindex="0" aria-label="${e.title}">
        <img loading="lazy" src="${e.cover || ''}" alt="${e.title}">
        <figcaption>
          <h3>${e.title}</h3>
          <p>ğŸ—“ ${formatDate(e.dateStart)}ï½œ${e.location || ''}</p>
          <div class="chips">${createTagChips(e.tags || [])}</div>
          <div class="card-actions">
            ${e.videoUrl ? `<a class="btn primary" href="${e.videoUrl}" target="_blank" rel="noopener">è§€çœ‹å½±ç‰‡</a>` : ""}
            <button class="btn ghost" data-detail="${e.id}">çœ‹è©³æƒ…</button>
          </div>
        </figcaption>
      </figure>`;
    }

    /* ============== 3) æ¸²æŸ“å‡½å¼ï¼ˆåƒ…é  type åˆ†é ï¼Œæ—¥æœŸåªç”¨ä¾†æ’åºï¼‰ ============== */
    function matchKeyword(e, kw) {
      if (!kw) return true;
      const hay = [
        e.title, e.location, e.city, e.summary, ...(e.tags || [])
      ].join(" ").toLowerCase();
      return hay.includes(kw.toLowerCase());
    }
    function matchTag(e, tag) {
      if (!tag) return true;
      return (e.tags || []).includes(tag);
    }

    function renderLatest(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "upcoming")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : Infinity) - (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : Infinity));
      list.innerHTML = data.map(cardHTML).join("");
      $("#latestEmpty").hidden = data.length !== 0;
    }

    function renderHistory(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "past")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : -Infinity) - (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : -Infinity));
      list.innerHTML = data.map(timelineHTML).join("");
      $("#historyEmpty").hidden = data.length !== 0;
    }

    function renderPortfolio(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "portfolio")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : -Infinity) - (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : -Infinity));
      list.innerHTML = data.map(portfolioHTML).join("");
      $("#portfolioEmpty").hidden = data.length !== 0;
    }

    /* ============== 4) åˆ†é åˆ‡æ›ï¼ˆhash è·¯ç”±ï¼‰ ============== */
    const panels = {
      latest: $("#panel-latest"),
      history: $("#panel-history"),
      portfolio: $("#panel-portfolio"),
    };
    function switchTab(tab) {
      Object.entries(panels).forEach(([k, el]) => {
        el.hidden = (k !== tab);
      });
      $$(".subnav-link").forEach(a => {
        a.classList.toggle("active", a.dataset.tab === tab);
        if (a.dataset.tab === tab) a.setAttribute("aria-current", "page");
        else a.removeAttribute("aria-current");
      });
      document.activeElement && document.activeElement.blur();
    }

    function handleHashChange() {
      const tab = (location.hash.replace("#","") || "latest");
      switchTab(tab);
      const kw = $("#search").value.trim();
      const tg = $("#tagFilter").value;
      renderLatest($("#latestList"), kw, tg);
      renderHistory($("#historyList"), kw, tg);
      renderPortfolio($("#portfolioList"), kw, tg);
    }

    /* ============== 5) è©³æƒ… Modal ============== */
    const dialog = $("#eventDialog");
    const dialogBody = $("#dialogBody");

    function openDetail(id) {
      const e = events.find(x => x.id === id);
      if (!e) return;
      dialogBody.innerHTML = `
        <div class="detail">
          <img class="detail-cover" src="${e.cover || ''}" alt="${e.title}">
          <div class="detail-info">
            <h3>${e.title}</h3>
            <p>ğŸ—“ ${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}</p>
            <p>ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
            <div class="chips">${createTagChips(e.tags || [])}</div>
            <p class="detail-desc">${e.summary || ""}</p>
            <div class="detail-actions">
              ${e.ticketUrl ? `<a class="btn primary" href="${e.ticketUrl}" target="_blank" rel="noopener">å‰å¾€å ±å</a>` : ""}
              ${e.videoUrl ? `<a class="btn" href="${e.videoUrl}" target="_blank" rel="noopener">è§€çœ‹å½±ç‰‡</a>` : ""}
            </div>
          </div>
        </div>
      `;
      dialog.showModal();
    }

    dialog.addEventListener("click", (ev) => {
      const rect = dialog.querySelector(".dialog-body").getBoundingClientRect();
      const inDialog = ev.clientX >= rect.left && ev.clientX <= rect.right && ev.clientY >= rect.top && ev.clientY <= rect.bottom;
      if (!inDialog) dialog.close();
    });

    document.body.addEventListener("click", (ev) => {
      const btn = ev.target.closest("[data-detail]");
      if (btn) openDetail(btn.getAttribute("data-detail"));
    });

    /* ============== 6) æœå°‹èˆ‡æ¨™ç±¤äº‹ä»¶ ============== */
    $("#search").addEventListener("input", handleHashChange);
    $("#tagFilter").addEventListener("change", handleHashChange);

    /* ============== 7) åˆå§‹åŒ– ============== */
    (function init() {
      $("#year").textContent = new Date().getFullYear();
      populateTagFilter();

      // æ¬¡ç´šå°è¦½é»æ“Šï¼ˆé¿å…é‡è¼‰ï¼‰
      $$(".subnav a[data-tab]").forEach(a => {
        a.addEventListener("click", (e) => {
          e.preventDefault();
          const tab = a.dataset.tab;
          history.replaceState(null, "", `#${tab}`);
          handleHashChange();
        });
      });

      if (!location.hash) location.hash = "#latest";
      handleHashChange();
      window.addEventListener("hashchange", handleHashChange);

      injectStructuredData(events);
    })();

    /* ============== 8) JSON-LDï¼ˆSEO çµæ§‹åŒ–è³‡æ–™ï¼‰ ============== */
    function injectStructuredData(items) {
      const upcoming = items.filter(i => (i.type || "").trim() === "upcoming");
      const ld = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜ æ´»å‹•åˆ—è¡¨",
        "itemListElement": upcoming.map((e, idx) => ({
          "@type": "ListItem",
          "position": idx + 1,
          "item": {
            "@type": "Event",
            "name": e.title,
            "startDate": e.dateStart,
            ...(e.dateEnd ? {"endDate": e.dateEnd} : {}),
            "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
            "location": {"@type": "Place","name": e.location,"address": e.city || ""},
            "image": e.cover || "",
            "description": e.summary || "",
            ...(e.ticketUrl ? {"offers": {"@type": "Offer","url": e.ticketUrl,"availability": "https://schema.org/InStock"}} : {})
          }
        }))
      };
      const script = document.createElement("script");
      script.type = "application/ld+json";
      script.textContent = JSON.stringify(ld, null, 2);
      document.head.appendChild(script);
    }
  </script>
</body>
</html>

