<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>æ´»å‹•è³‡è¨Šï½œæ–°ç¾©å’Œæ­ŒåŠ‡åœ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="æœ€æ–°æ´»å‹•ã€æ´»å‹•ç´€éŒ„èˆ‡ä½œå“é›†ï¼Œä¸€é æŒæ¡æ¼”å‡ºè³‡è¨Šã€å ±åé€£çµèˆ‡ç²¾å½©å›é¡§ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="activities.css">
  <link rel="icon" href="favicon.ico">
</head>
<body>
  <!-- é é¦– / æ¬¡ç´šå°è¦½ -->
  <header class="site-header">
    <div class="container head-wrap">
      <a class="brand" href="home.html" aria-label="å›åˆ°é¦–é ">
      <!-- è‹¥ç›®å‰åªæœ‰ã€Œç™½åº•é»‘å­—ã€logo.pngï¼Œå…ˆç”¨ .invert åè½‰æˆé»‘åº•ç™½å­— -->
      <img class="brand-logo invert" src="img/logo.png" alt="æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜">
    </a>

      <nav class="subnav" aria-label="æ´»å‹•é å°è¦½">
        <a class="subnav-link" href="home.html">é¦–é </a>
        <a class="subnav-link" href="#latest" data-tab="latest" aria-current="page">æœ€æ–°æ´»å‹•</a>
        <a class="subnav-link" href="#history" data-tab="history">æ´»å‹•ç´€éŒ„</a>
        <a class="subnav-link" href="#portfolio" data-tab="portfolio">ä½œå“é›†</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1>æ´»å‹•è³‡è¨Š</h1>
      <p class="hero-sub">ğŸ“£ è¿½è¹¤å³å°‡ä¸Šæ¼”çš„ç¯€ç›®ã€å›é¡§æ­·ä¾†æ¼”å‡ºèˆ‡ç²¾é¸ä½œå“ã€‚è©³ç´°è³‡è¨Šæ­¡è¿åˆ°å®˜æ–¹Lineè©¢å•!</p>
      <div class="filters">
        <label class="sr-only" for="search">æœå°‹æ´»å‹•</label>
        <input id="search" class="search" type="search" placeholder="æœå°‹é—œéµå­—ï¼ˆæ¨™é¡Œã€åœ°é»ã€æ¨™ç±¤ï¼‰â€¦" />
        <select id="tagFilter" class="tag-filter" aria-label="ä¾æ¨™ç±¤ç¯©é¸">
          <option value="">å…¨éƒ¨æ¨™ç±¤</option>
        </select>
      </div>
    </div>
  </section>

  <!-- åˆ†é å…§å®¹ -->
  <main class="container">
    <section id="panel-latest" class="panel" role="region" aria-labelledby="tab-latest">
      <h2 id="tab-latest" class="panel-title">æœ€æ–°æ´»å‹•</h2>
      <div id="latestList" class="card-grid" aria-live="polite"></div>
      <div class="empty" id="latestEmpty" hidden>ç›®å‰æ²’æœ‰å³å°‡èˆ‰è¾¦çš„æ´»å‹•ï¼Œæ•¬è«‹æœŸå¾…ï¼</div>
    </section>

    <section id="panel-history" class="panel" role="region" aria-labelledby="tab-history" hidden>
      <h2 id="tab-history" class="panel-title">æ´»å‹•ç´€éŒ„</h2>
      <div id="historyList" class="timeline" aria-live="polite"></div>
      <div class="empty" id="historyEmpty" hidden>å°šç„¡æ´»å‹•ç´€éŒ„ã€‚</div>
    </section>

    <section id="panel-portfolio" class="panel" role="region" aria-labelledby="tab-portfolio" hidden>
      <h2 id="tab-portfolio" class="panel-title">ä½œå“é›†</h2>
      <div id="portfolioList" class="masonry" aria-live="polite"></div>
      <div class="empty" id="portfolioEmpty" hidden>å°šæœªå»ºç«‹ä½œå“é›†é …ç›®ã€‚</div>
    </section>
  </main>

  <!-- æ´»å‹•è©³æƒ… Modalï¼ˆä¸é¡¯ç¤ºåœ–ç‰‡ï¼‰ -->
  <dialog id="eventDialog" class="event-dialog" aria-label="æ´»å‹•è©³æƒ…">
    <form method="dialog">
      <button class="close" aria-label="é—œé–‰">âœ•</button>
    </form>
    <div class="dialog-body" id="dialogBody"></div>
  </dialog>

  <footer class="site-footer">
    <div class="container">
      <small>Â© <span id="year"></span> æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜ï½œAll Rights Reserved.</small>
    </div>
  </footer>

  <!-- ======== JSï¼ˆåˆä½µåœ¨ HTMLï¼‰======== -->
  <script>
    /* ============== 0) ç¯„ä¾‹è³‡æ–™ï¼ˆå…ˆé€™æ¨£æ”¾ï¼Œä¹‹å¾Œæ›æˆä½ çš„çœŸå¯¦è³‡æ–™ï¼‰ ============== */
    const events = [
      /* ---------- ä¸ƒæœˆï¼ˆå°æ‡‰åœ‹æ›† 8â€“9 æœˆï¼‰ ---------- */
      {
        id: "u-20250827-fuxing-zhentiangong",
        title: "å°åŒ—å¾©èˆˆåŒ—è·¯",
        dateStart: "2025-08-27",
        location: "å°åŒ—å¾©èˆˆåŒ—è·¯",
        tags: ["å®®å»Ÿ","æ´»å‹•","å°åŒ—"],
        summary: "è¾²æ›† 7/5ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20250904-0925-baishatun",
        title: "è‹—æ —ç™½æ²™å±¯",
        dateStart: "2025-09-04",
        dateEnd:   "2025-09-12",
        location: "è‹—æ —ç™½æ²™å±¯",
        tags: ["å®®å»Ÿ","é€£çºŒå¤šæ—¥","è‹—æ —"],
        summary: "è¾²æ›† 7/13â€“7/16ï¼Œé€£çºŒå¤šæ—¥æ´»å‹•ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20250905-gongliao-hemei",
        title: "æ–°åŒ—è²¢å¯®å’Œç¾",
        dateStart: "2025-09-05",
        location: "æ–°åŒ—è²¢å¯®å’Œç¾",
        tags: ["å®®å»Ÿ","æ–°åŒ—"],
        summary: "è¾²æ›† 7/14ã€‚",
        type: "upcoming"
      },
      {
        id: "u-7m-16-30-malinggong",
        title: "è‹—æ —å¾Œé¾",
        dateStart: "2025-09-07",
        dateEnd:   "2025-09-25",
        location: "è‹—æ —å¾Œé¾",
        tags: ["å®®å»Ÿ","è‹—æ —","é€£çºŒå¤šæ—¥"],
        summary: "è¾²æ›† 7/16â€“7/30ï¼Œé€£çºŒå¤šæ—¥æ´»å‹•ã€‚",
        type: "upcoming"
      },

      /* ---------- å…«æœˆï¼ˆå°æ‡‰åœ‹æ›† 9â€“10 æœˆï¼‰ ---------- */
      {
        id: "u-20250922-houlong-baixing",
        title: "è‹—æ —å¾Œé¾",
        dateStart: "2025-09-22",
        location: "å¾Œé¾ç™¾å§“å…¬",
        tags: ["å®®å»Ÿ","è‹—æ —"],
        summary: "è¾²æ›† 8/1ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20250926-27-jingmei-xizhou-fude",
        title: "å°åŒ—æ™¯ç¾æºªå·",
        dateStart: "2025-09-26",
        dateEnd:   "2025-09-27",
        location: "å°åŒ—æ™¯ç¾æºªå·",
        tags: ["å®®å»Ÿ","å°åŒ—"],
        summary: "è¾²æ›† 8/5â€“8/6ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20250929-shimen-fude",
        title: "æ”¯æ´é‡‘é¾ æ–°åŒ—çŸ³é–€",
        dateStart: "2025-09-29",
        location: "çŸ³é–€",
        tags: ["å®®å»Ÿ","æ”¯æ´","æ–°åŒ—"],
        summary: "è¾²æ›† 8/8ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20250930-sanchong-jiexing",
        title: "æ”¯æ´æ°‘æ¬Š æ–°åŒ—ä¸‰é‡",
        dateStart: "2025-09-30",
        location: "ä¸‰é‡",
        tags: ["å®®å»Ÿ","æ”¯æ´","æ–°åŒ—"],
        summary: "è¾²æ›† 8/9ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251001-hsinchu-wenhua-fude",
        title: "æ–°ç«¹æ–‡è¯",
        dateStart: "2025-10-01",
        location: "æ–°ç«¹æ–‡è¯",
        tags: ["å®®å»Ÿ","æ–°ç«¹"],
        summary: "è¾²æ›† 8/10ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251004-xinfeng-senmei",
        title: "æ”¯æ´æ£®ç¾ æ–°ç«¹æ–°è±",
        dateStart: "2025-10-04",
        location: "æ–°ç«¹æ–°è±",
        tags: ["æ´»å‹•","æ”¯æ´","æ–°ç«¹"],
        summary: "è¾²æ›† 8/13ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251010-11-zhudong-ronghua-fude",
        title: "æ”¯æ´ç‹ä¸–é‡‘ æ–°ç«¹ç«¹æ±æ¦®è¯",
        dateStart: "2025-10-10",
        dateEnd:   "2025-10-11",
        location: "æ–°ç«¹ç«¹æ±æ¦®è¯",
        tags: ["å®®å»Ÿ","æ”¯æ´","æ–°ç«¹"],
        summary: "è¾²æ›† 8/19â€“8/20ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251013-taichung-fengyuan",
        title: "å°ä¸­è±åŸ",
        dateStart: "2025-10-13",
        location: "å°ä¸­è±åŸ",
        tags: ["æ´»å‹•","å°ä¸­"],
        summary: "è¾²æ›† 8/22ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251014-15-longdong-longxing",
        title: "æ–°åŒ—é¾æ´",
        dateStart: "2025-10-14",
        dateEnd:   "2025-10-15",
        location: "æ–°åŒ—é¾æ´",
        tags: ["å®®å»Ÿ","æ–°åŒ—"],
        summary: "è¾²æ›† 8/23â€“8/24ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251017-19-sanxia-xibeili",
        title: "æ–°åŒ—ä¸‰å³½æºªåŒ—é‡Œ",
        dateStart: "2025-10-17",
        dateEnd:   "2025-10-19",
        location: "æ–°åŒ—ä¸‰å³½æ©«æºªè·¯17è™Ÿ",
        tags: ["æ´»å‹•","æ–°åŒ—"],
        summary: "è¾²æ›† 8/26â€“8/28ã€‚",
        type: "upcoming"
      },
    
      /* ---------- ä¹æœˆï¼ˆå°æ‡‰åœ‹æ›† 10â€“11 æœˆï¼‰ ---------- */
      {
        id: "u-20251021-22-qingshui",
        title: "å°ä¸­æ¸…æ°´",
        dateStart: "2025-10-21",
        dateEnd:   "2025-10-22",
        location: "å°ä¸­æ¸…æ°´",
        tags: ["æ´»å‹•","å°ä¸­"],
        summary: "è¾²æ›† 9/1â€“9/2ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251024-hsinchu-wangxiansheng",
        title: "æ–°ç«¹",
        dateStart: "2025-10-24",
        location: "æ–°ç«¹",
        tags: ["å®®å»Ÿ","æ–°ç«¹"],
        summary: "è¾²æ›† 9/4ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251029-banqiao-shenqiu-fude",
        title: "æ–°åŒ—æ¿æ©‹æ·±ç§‹",
        dateStart: "2025-10-29",
        location: "æ–°åŒ—æ¿æ©‹æ·±ç§‹",
        tags: ["å®®å»Ÿ","æ–°åŒ—"],
        summary: "è¾²æ›† 9/9ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251031-taoyuan-yushan-street",
        title: "æ”¯æ´ç‹ä¸–é‡‘ æ¡ƒåœ’ç‰å±±è¡—",
        dateStart: "2025-10-31",
        location: "æ”¯æ´ä¸–é‡‘ æ¡ƒåœ’å¸‚ç‰å±±è¡—",
        tags: ["æ´»å‹•","æ”¯æ´","æ¡ƒåœ’"],
        summary: "è¾²æ›† 9/11ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251103-wugu-shanan",
        title: "æ–°åŒ—äº”è‚¡",
        dateStart: "2025-11-03",
        location: "æ–°åŒ—äº”è‚¡",
        tags: ["å®®å»Ÿ","æ–°åŒ—"],
        summary: "è¾²æ›† 9/14ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251104-05-hemei-baoan",
        title: "æ–°åŒ—å’Œç¾",
        dateStart: "2025-11-04",
        dateEnd:   "2025-11-05",
        location: "æ–°åŒ—å’Œç¾",
        tags: ["å®®å»Ÿ","æ–°åŒ—"],
        summary: "è¾²æ›† 9/15â€“9/16ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251107-yilan-zhuangwei",
        title: "å®œè˜­å£¯åœ",
        dateStart: "2025-11-07",
        location: "å®œè˜­å£¯åœ",
        tags: ["æ´»å‹•","å®œè˜­"],
        summary: "è¾²æ›† 9/18ã€‚",
        type: "upcoming"
      },
    
      /* ---------- åæœˆï¼ˆå°æ‡‰åœ‹æ›† 11â€“12 æœˆï¼‰ ---------- */
      {
        id: "u-20251122-huitian",
        title: "è‹—æ —å¾Œé¾",
        dateStart: "2025-11-22",
        location: "è‹—æ —å¾Œé¾",
        tags: ["å®®å»Ÿ","è‹—æ —"],
        summary: "è¾²æ›† 10/3ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251130-tanwen-senmei",
        title: "æ”¯æ´æ£®ç¾ è‹—æ —é€ æ©‹",
        dateStart: "2025-11-30",
        location: "è‹—æ —é€ æ©‹",
        tags: ["æ´»å‹•","è‹—æ —"],
        summary: "è¾²æ›† 10/11ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251203-nanqing",
        title: "å°ä¸­æ¸…æ°´",
        dateStart: "2025-12-03",
        location: "å°ä¸­æ¸…æ°´",
        tags: ["å®®å»Ÿ","å°ä¸­"],
        summary: "è¾²æ›† 10/14ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251206-zaoqiao-shijjn",
        title: "æ”¯æ´ç‹ä¸–é‡‘ è‹—æ —é€ æ©‹",
        dateStart: "2025-12-06",
        location: "è‹—æ —é€ æ©‹",
        tags: ["æ´»å‹•","è‹—æ —"],
        summary: "è¾²æ›† 10/17ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251211-12-xingan-senmei",
        title: "æ”¯æ´æ£®ç¾ è‹—æ —ç™½æ²™å±¯",
        dateStart: "2025-12-11",
        dateEnd:   "2025-12-12",
        location: "è‹—æ —ç™½æ²™å±¯",
        tags: ["å®®å»Ÿ","è‹—æ —"],
        summary: "è¾²æ›† 10/22â€“10/23ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251213-houlong-ziyun-shangdi",
        title: "è‹—æ —å¾Œé¾",
        dateStart: "2025-12-13",
        location: "è‹—æ —å¾Œé¾",
        tags: ["å®®å»Ÿ","è‹—æ —"],
        summary: "è¾²æ›† 10/24ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251219-21-hsinchu-75",
        title: "æ–°ç«¹",
        dateStart: "2025-12-19",
        dateEnd:   "2025-12-21",
        location: "æ–°ç«¹",
        tags: ["å®®å»Ÿ","æ–°ç«¹"],
        summary: "è¾²æ›† 10/30â€“11/2ã€‚",
        type: "upcoming"
      },
    
      /* ---------- åä¸€æœˆï¼ˆå°æ‡‰åœ‹æ›† 12 æœˆèˆ‡æ¬¡å¹´ 1 æœˆï¼‰ ---------- */
      {
        id: "u-20251220-qingshui-senmei",
        title: "æ”¯æ´æ£®ç¾ å°ä¸­æ¸…æ°´",
        dateStart: "2025-12-20",
        location: "å°ä¸­å¸‚æ¸…æ°´å€",
        tags: ["æ´»å‹•","å°ä¸­","æ”¯æ´"],
        summary: "è¾²æ›† 11/1ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20251228-sanmin",
        title: "æ¡ƒåœ’ä¸‰æ°‘",
        dateStart: "2025-12-28",
        location: "æ¡ƒåœ’ä¸‰æ°‘",
        tags: ["æ´»å‹•","æ¡ƒåœ’"],
        summary: "è¾²æ›† 11/9ã€‚",
        type: "upcoming"
      },
      {
        id: "u-20260102-houlong-baixing-senmei",
        title: "æ”¯æ´æ£®ç¾ è‹—æ —å¾Œé¾",
        dateStart: "2026-01-02",
        location: "å¾Œé¾ç™¾å§“å®®",
        tags: ["å®®å»Ÿ","è‹—æ —","æ”¯æ´"],
        summary: "è¾²æ›† 11/14ã€‚",
        type: "upcoming"
      },
      /* ============== æ­·å²æ´»å‹• ============= */
      {
        id: "h-2023-8-26",
        title: "é‡Œé•·æ´»å‹• é«”é©—æ­Œä»”æˆ² â€” å°ä¸­å¸‚å¿ å¹³é‡Œ",
        dateStart: "2023-8-26",
        location: "å°ä¸­å¸‚å¿ å¹³é‡Œ",
        tags: ["æ­Œä»”æˆ²","å°ä¸­","æ´»å‹•"],
        summary: "æˆ²å¤¢äººç”ŸÂ·æ­Œä»”æˆ²å…¨æ–¹ä½é«”é©—",
        gallery: ["img/é‡Œé•·æ´»å‹•_2023.08.26/1.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/2.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/3.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/4.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/5.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/6.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/7.jpg",
                  "img/é‡Œé•·æ´»å‹•_2023.08.26/8.jpg"
                 ],
        type: "past"
      },
      {
        id: "h-2023-7-25",
        title: "ã€ŠåŠ‰æµ·æˆ²é‡‘ç¦ªã€‹è€çˆºæˆ² â€” å—æŠ•ç¸£",
        dateStart: "2023-7-25",
        location: "å—æŠ•ç¸£",
        tags: ["æ­Œä»”æˆ²","å—æŠ•"],
        summary: "ç¥å£½ä¸€å¸½æ›æ–°æ­²ï¼Œä¸€æˆ²ç¥åƒç¥¥",
        gallery: ["img/è€çˆºæˆ²/1.jpg",
                  "img/è€çˆºæˆ²/2.jpg",
                  "img/è€çˆºæˆ²/3.jpg",
                  "img/è€çˆºæˆ²/4.jpg",
                  "img/è€çˆºæˆ²/5.jpg",
                  "img/è€çˆºæˆ²/6.jpg"
                 ],
        videoFile: "img/è€çˆºæˆ²/1.mp4",
        type: "past"
      },
      /* ============== ä½œå“é›† ============= */
      {
        id: "p-ig-luwenlong",
        title: "ç¶“å…¸é›»è¦–æ­Œä»”æˆ²ã€Šé™¸æ–‡é¾ã€‹æˆ²ä¸­æ›²èª¿",
        dateStart: "2025-08-18",           // æƒ³æ’åºé å‰å°±å¡«ä»Šå¤©æˆ–æœ€è¿‘æ—¥æœŸï¼›ä¸å¡«ä¹Ÿå¯
        location: "Instagram Reels",
        city: "ç·šä¸Š",
        cover: "https://picsum.photos/seed/luwenlong/800/500", // å»ºè­°æ›æˆä½ è‡ªå·±çš„å°é¢åœ–ç¶²å€
        tags: ["ä½œå“é›†", "èŠ±çµ®", "æ­Œä»”æˆ²"],
        summary: "ç‰‡æ®µèŠ±çµ®ï¼šç¶“å…¸é›»è¦–æ­Œä»”æˆ²ã€Šé™¸æ–‡é¾ã€‹ä¸­çš„æ›²èª¿ç¯€é¸ã€‚",
        videoUrl: "https://www.instagram.com/reel/DNahemuyJDC/?igsh=ODhwNGhtZms0dHQ4",
        videoThumb: "img/é™¸æ–‡é¾èŠ±çµ®.jpg",
        type: "portfolio"
      }
    ];

    /* ============== 1) å°å·¥å…· ============== */
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    // åªé¡¯ç¤ºã€Œæ—¥æœŸã€YYYY-MM-DDï¼ˆä¸ç®¡åŸå§‹å­—ä¸²æ˜¯å¦å«æ™‚é–“ï¼‰
    const formatDate = (iso) => {
      if (!iso) return "æ—¥æœŸæœªå®š";
      const t = Date.parse(iso);
      if (!Number.isFinite(t)) {
        // è‹¥å®Œå…¨ç„¡æ³•è§£æï¼Œå°±å˜—è©¦åˆ‡å‡ºå‰ 10 ç¢¼ YYYY-MM-DDï¼›å†ä¸è¡Œå°±åŸæ¨£å›å‚³
        return /^\d{4}-\d{2}-\d{2}/.test(iso) ? iso.slice(0,10) : iso;
      }
      const d = new Date(t);
      const Y = d.getFullYear();
      const M = String(d.getMonth()+1).padStart(2,'0');
      const D = String(d.getDate()).padStart(2,'0');
      return `${Y}-${M}-${D}`;
    };

    function createTagChips(tags = []) {
      return tags.map(t => `<span class="chip" data-chip="${t}">${t}</span>`).join("");
    }

    // åªè¦ event æœ‰ videoFile æˆ– videoUrlï¼Œå°±æœƒåœ¨è©³æƒ…å½ˆçª—æ’å…¥å½±ç‰‡
    function ensureIGScript() {
      if (!document.querySelector('script[src*="instagram.com/embed.js"]')) {
        const s = document.createElement('script');
        s.async = true;
        s.src = 'https://www.instagram.com/embed.js';
        document.body.appendChild(s);
      } else {
        window.instgrm?.Embeds?.process();
      }
    }
    
    function buildVideoBlock(e){
      // ç«™å…§ mp4
      if (e.videoFile) {
        return `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <video class="detail-video" controls preload="metadata" playsinline>
            <source src="${e.videoFile}" type="video/mp4">
            ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
          </video>
        `;
      }
    
      // YouTube
      if (e.videoUrl && /(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_\-]+)/.test(e.videoUrl)) {
        const id = RegExp.$1;
        return `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <div class="video-embed">
            <iframe
              src="https://www.youtube.com/embed/${id}"
              title="YouTube video player" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen loading="lazy"></iframe>
          </div>
        `;
      }
    
      // Vimeo
      if (e.videoUrl && /vimeo\.com\/(\d+)/.test(e.videoUrl)) {
        const id = RegExp.$1;
        return `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <div class="video-embed">
            <iframe
              src="https://player.vimeo.com/video/${id}"
              frameborder="0" allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen loading="lazy"></iframe>
          </div>
        `;
      }
    
      // Instagramï¼ˆReels / è²¼æ–‡ï¼‰
      if (e.videoUrl && /instagram\.com/.test(e.videoUrl)) {
        ensureIGScript();
        // è®“ IG é‡æ–°æƒæè¼‰å…¥
        setTimeout(() => window.instgrm?.Embeds?.process(), 0);
        return `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <blockquote class="instagram-media" data-instgrm-permalink="${e.videoUrl}" data-instgrm-captioned style="background:#0b0c0f; border:0; margin: 0 auto; max-width:540px; width:100%"></blockquote>
        `;
      }
    
      // å…¶ä»–é€£çµï¼šçµ¦ä¸€å€‹å¤–é–‹æŒ‰éˆ•
      if (e.videoUrl) {
        return `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <p><a class="btn primary" href="${e.videoUrl}" target="_blank" rel="noopener">å‰å¾€è§€çœ‹</a></p>
        `;
      }
    
      return "";
    }

    function populateTagFilter() {
      const set = new Set();
      events.forEach(e => (e.tags || []).forEach(t => set.add(t)));
      const sel = $("#tagFilter");
      [...set].sort().forEach(tag => {
        const opt = document.createElement("option");
        opt.value = tag; opt.textContent = tag;
        sel.appendChild(opt);
      });
    }

    /* ============== 2) HTML ç”Ÿæˆï¼ˆä¸å«åœ–ç‰‡ï¼‰ ============== */
    function cardHTML(e){
      return `
      <article class="card" tabindex="0" aria-label="${e.title}">
        <div class="card-body">
          <h3 class="card-title">${e.title}</h3>
          <p class="card-meta">ğŸ—“ ${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}</p>
          <p class="card-meta">ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
          <p class="card-desc">${e.summary || ""}</p>
          <div class="card-tags">${createTagChips(e.tags || [])}</div>
          <div class="card-actions">
            ${e.ticketUrl ? `<a class="btn primary" href="${e.ticketUrl}" target="_blank" rel="noopener">ç«‹å³å ±å</a>` : ""}
          </div>
        </div>
      </article>`;
    }

    function timelineHTML(e){
      return `
      <div class="time-item">
        <div class="time-dot" aria-hidden="true"></div>
        <div class="time-content">
          <time class="time-date">${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}</time>
          <h3 class="time-title">${e.title}</h3>
          <p class="time-meta">ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
          <div class="time-tags">${createTagChips(e.tags || [])}</div>
          <div class="time-actions">
            <button class="btn ghost" data-detail="${e.id}">çœ‹å›é¡§</button>
          </div>
        </div>
      </div>`;
    }

    function portfolioHTML(e){
      return `
      <figure class="masonry-item" tabindex="0" aria-label="${e.title}">
        <figcaption>
          <h3>${e.title}</h3>
          <p>ğŸ—“ ${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}ï½œ${e.location || ''}</p>
          <div class="chips">${createTagChips(e.tags || [])}</div>
          <div class="card-actions">
            ${e.videoUrl ? `<a class="btn primary" href="${e.videoUrl}" target="_blank" rel="noopener">è§€çœ‹å½±ç‰‡</a>` : ""}
            <button class="btn ghost" data-detail="${e.id}">çœ‹è©³æƒ…</button>
          </div>
        </figcaption>
      </figure>`;
    }

    /* ============== 3) æ¸²æŸ“ï¼ˆä¾ type åˆ†é ï¼Œæ—¥æœŸåªæ’åºä¸é¡¯ç¤ºæ™‚é–“ï¼‰ ============== */
    const safeTime = iso => Number.isFinite(Date.parse(iso)) ? Date.parse(iso) : NaN;
    function matchKeyword(e, kw) {
      if (!kw) return true;
      const hay = [e.title, e.location, e.city, e.summary, ...(e.tags || [])].join(" ").toLowerCase();
      return hay.includes(kw.toLowerCase());
    }
    function matchTag(e, tag) {
      if (!tag) return true;
      return (e.tags || []).includes(tag);
    }

    function renderLatest(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "upcoming")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : Infinity) - (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : Infinity));
      list.innerHTML = data.map(cardHTML).join("");
      $("#latestEmpty").hidden = data.length !== 0;
    }

    function renderHistory(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "past")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : -Infinity) - (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : -Infinity));
      list.innerHTML = data.map(timelineHTML).join("");
      $("#historyEmpty").hidden = data.length !== 0;
    }

    function renderPortfolio(list, kw="", tag="") {
      const data = events
        .filter(e => (e.type || "").trim() === "portfolio")
        .filter(e => matchKeyword(e, kw) && matchTag(e, tag))
        .sort((a,b) => (Number.isFinite(safeTime(b.dateStart)) ? safeTime(b.dateStart) : -Infinity) - (Number.isFinite(safeTime(a.dateStart)) ? safeTime(a.dateStart) : -Infinity));
      list.innerHTML = data.map(portfolioHTML).join("");
      $("#portfolioEmpty").hidden = data.length !== 0;
    }

    /* ============== 4) åˆ†é åˆ‡æ›ï¼ˆhash è·¯ç”±ï¼‰ ============== */
    const panels = {
      latest: $("#panel-latest"),
      history: $("#panel-history"),
      portfolio: $("#panel-portfolio"),
    };
    function switchTab(tab) {
      Object.entries(panels).forEach(([k, el]) => el.hidden = (k !== tab));
      $$(".subnav-link").forEach(a => {
        a.classList.toggle("active", a.dataset.tab === tab);
        if (a.dataset.tab === tab) a.setAttribute("aria-current", "page");
        else a.removeAttribute("aria-current");
      });
      document.activeElement && document.activeElement.blur();
    }

    function handleHashChange() {
      const tab = (location.hash.replace("#","") || "latest");
      switchTab(tab);
      const kw = $("#search").value.trim();
      const tg = $("#tagFilter").value;
      renderLatest($("#latestList"), kw, tg);
      renderHistory($("#historyList"), kw, tg);
      renderPortfolio($("#portfolioList"), kw, tg);
    }

    /* ============== 5) è©³æƒ… Modal ============== */
    const dialog = $("#eventDialog");
    const dialogBody = $("#dialogBody");
    
    function openDetail(id) {
      const e = events.find(x => x.id === id);
      if (!e) return;
    
      const isPortfolio = ((e.type || "").trim() === "portfolio");
    
      // åŸºæœ¬è³‡è¨Šï¼ˆä½œå“é›†æ™‚ä¸é¡¯ç¤ºã€Œå¦é–‹å½±ç‰‡ã€æŒ‰éˆ•ï¼‰
      let html = `
        <div class="detail">
          <div class="detail-info">
            <h3>${e.title}</h3>
            <p>ğŸ—“ ${formatDate(e.dateStart)}${e.dateEnd ? ' - ' + formatDate(e.dateEnd) : ''}</p>
            <p>ğŸ“ ${e.location || ''}${e.city ? 'ï¼ˆ' + e.city + 'ï¼‰' : ''}</p>
            <div class="chips">${createTagChips(e.tags || [])}</div>
            <p class="detail-desc">${e.summary || ""}</p>
            <div class="detail-actions">
              ${e.ticketUrl ? `<a class="btn primary" href="${e.ticketUrl}" target="_blank" rel="noopener">å‰å¾€å ±å</a>` : ""}
              ${(!isPortfolio && e.videoUrl) ? `<a class="btn" href="${e.videoUrl}" target="_blank" rel="noopener">å¦é–‹å½±ç‰‡</a>` : ""}
            </div>
          </div>
        </div>
      `;
    
      // å½±ç‰‡å€å¡Š
      if (e.videoFile) {
        // ä½ çš„ mp4ï¼šåœ¨é é¢å…§æ’­æ”¾
        html += `
          <h4 class="gallery-title">å½±ç‰‡</h4>
          <video class="detail-video" controls preload="metadata" playsinline>
            <source src="${e.videoFile}" type="video/mp4">
            ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
          </video>
        `;
      } else if (e.videoUrl) {
        if (isPortfolio) {
          // ä½œå“é›† + å¤–éƒ¨é€£çµï¼šä¸å…§åµŒï¼Œæ”¹æˆå¯é»ç¸®åœ–å¡
          const provider =
            /instagram\.com/.test(e.videoUrl) ? "Instagram" :
            /(youtu\.be|youtube\.com)/.test(e.videoUrl) ? "YouTube" :
            /vimeo\.com/.test(e.videoUrl) ? "Vimeo" : "å¤–éƒ¨å¹³å°";
          const thumb = e.videoThumb || e.cover || ""; // å„ªå…ˆç”¨ä½ æ–°åŠ çš„ videoThumbï¼Œæ²’æœ‰å°±é€€å› cover
          html += `
            <h4 class="gallery-title">å½±ç‰‡</h4>
            <a href="${e.videoUrl}" target="_blank" rel="noopener"
               class="video-link has-thumb" aria-label="å‰å¾€${provider}è§€çœ‹">
              ${thumb ? `<img src="${thumb}" alt="${e.title} å½±ç‰‡é è¦½" loading="lazy" onerror="this.style.display='none'">` : ""}
              <div class="vl-center">
                <span class="vl-play">â–¶</span>
                <span class="vl-text">å‰å¾€${provider}è§€çœ‹</span>
              </div>
            </a>
          `;
          // ä¸è¼‰å…¥ä»»ä½•å¤–éƒ¨åµŒå…¥è…³æœ¬
        } else {
          // å…¶ä»–åˆ†é¡ï¼šè‹¥å°ˆæ¡ˆå·²å®šç¾© buildVideoBlockï¼Œå°±ç”¨å®ƒå…§åµŒï¼›æ²’æœ‰å°±åªé¡¯ç¤ºä¸Šé¢çš„ã€Œå¦é–‹å½±ç‰‡ã€æŒ‰éˆ•
          if (typeof buildVideoBlock === "function") {
            html += buildVideoBlock(e);
          }
        }
      }
    
      // ç›¸ç°¿ï¼ˆå« lightboxï¼‰
      if (e.gallery && e.gallery.length) {
        html += `
          <h4 class="gallery-title">ç¾å ´ç…§ç‰‡</h4>
          <div class="gallery-grid">
            ${e.gallery.map((src, i) => `
              <a href="${src}" data-idx="${i}">
                <img src="${src}" alt="${e.title} ç¾å ´ç…§ç‰‡ ${i+1}" loading="lazy"
                     onerror="this.style.display='none'">
              </a>
            `).join("")}
          </div>
    
          <div class="lightbox" id="lightbox" hidden aria-modal="true" role="dialog">
            <button class="lb-close" aria-label="é—œé–‰">âœ•</button>
            <button class="lb-prev" aria-label="ä¸Šä¸€å¼µ">â€¹</button>
            <img class="lb-img" src="" alt="">
            <button class="lb-next" aria-label="ä¸‹ä¸€å¼µ">â€º</button>
            <div class="lb-counter" aria-live="polite"></div>
          </div>
        `;
      }
    
      // å¯«å…¥ä¸¦é–‹å•Ÿå°è©±æ¡†
      dialogBody.innerHTML = html;
      dialog.showModal();
    
      // ç¶å®š lightboxï¼ˆå·¦å³åˆ‡æ›ã€éµç›¤ã€æ»‘é¼ æ‹–æ›³ã€è§¸æ§ï¼‰
      const grid = dialogBody.querySelector(".gallery-grid");
      const lb   = dialogBody.querySelector("#lightbox");
      if (grid && lb) {
        const thumbs = Array.from(grid.querySelectorAll("a"));
        const state = { idx: 0, gallery: e.gallery.slice(), title: e.title };
    
        function render() {
          const img = lb.querySelector(".lb-img");
          const counter = lb.querySelector(".lb-counter");
          img.src = state.gallery[state.idx];
          img.alt = `${state.title} ç¾å ´ç…§ç‰‡ ${state.idx+1}`;
          counter.textContent = `${state.idx+1} / ${state.gallery.length}`;
        }
        function openLB(i){ state.idx = i; lb.hidden = false; render(); document.addEventListener("keydown", onKey); }
        function closeLB(){ lb.hidden = true; document.removeEventListener("keydown", onKey); }
        function prev(){ state.idx = (state.idx - 1 + state.gallery.length) % state.gallery.length; render(); }
        function next(){ state.idx = (state.idx + 1) % state.gallery.length; render(); }
        function onKey(ev){
          if (ev.key === "Escape") closeLB();
          else if (ev.key === "ArrowLeft") prev();
          else if (ev.key === "ArrowRight") next();
        }
    
        thumbs.forEach(a => {
          a.addEventListener("click", ev => {
            ev.preventDefault();
            openLB(parseInt(a.dataset.idx, 10) || 0);
          });
        });
    
        // é˜²æ­¢é»ç®­é ­/é—œé–‰éˆ•æ™‚è¢«ç•¶ä½œé»åˆ°é®ç½©
        lb.querySelector(".lb-close").addEventListener("click", (ev) => { ev.stopPropagation(); closeLB(); });
        lb.querySelector(".lb-prev").addEventListener("click", (ev) => { ev.stopPropagation(); prev(); });
        lb.querySelector(".lb-next").addEventListener("click", (ev) => { ev.stopPropagation(); next(); });
    
        // é»é®ç½©æ‰é—œé–‰
        lb.addEventListener("click", ev => { if (ev.target === lb) closeLB(); });
    
        // æ»‘é¼ æ‹–æ›³ï¼ˆæ¡Œæ©Ÿï¼‰
        let dragStartX = null;
        lb.addEventListener("mousedown", e => { if (e.button === 0) dragStartX = e.clientX; });
        lb.addEventListener("mouseup",   e => {
          if (dragStartX == null) return;
          const dx = e.clientX - dragStartX;
          if (Math.abs(dx) > 40) (dx < 0 ? next() : prev());
          dragStartX = null;
        });
        lb.addEventListener("mouseleave", () => { dragStartX = null; });
    
        // è§¸æ§æ»‘å‹•ï¼ˆæ‰‹æ©Ÿ/å¹³æ¿ï¼‰
        let startX = 0;
        lb.addEventListener("touchstart", e => { startX = e.touches[0].clientX; }, {passive:true});
        lb.addEventListener("touchend",   e => {
          const dx = e.changedTouches[0].clientX - startX;
          if (Math.abs(dx) > 40) (dx < 0 ? next() : prev());
        }, {passive:true});
      }
    }
    
    // ï¼ˆå‡½å¼å¤–ï¼‰å…¨åŸŸäº‹ä»¶ï¼šä¿ç•™
    dialog.addEventListener("click", (ev) => {
      const rect = dialog.querySelector(".dialog-body").getBoundingClientRect?.() || dialog.getBoundingClientRect();
      const inDialog = ev.clientX >= rect.left && ev.clientX <= rect.right && ev.clientY >= rect.top && ev.clientY <= rect.bottom;
      if (!inDialog) dialog.close();
    });
    document.body.addEventListener("click", (ev) => {
      const btn = ev.target.closest("[data-detail]");
      if (btn) openDetail(btn.getAttribute("data-detail"));
    });

    /* ============== 6) æœå°‹èˆ‡æ¨™ç±¤äº‹ä»¶ ============== */
    $("#search").addEventListener("input", handleHashChange);
    $("#tagFilter").addEventListener("change", handleHashChange);

    /* ============== 7) åˆå§‹åŒ– ============== */
    (function init() {
      $("#year").textContent = new Date().getFullYear();
      populateTagFilter();
      $$(".subnav a[data-tab]").forEach(a => {
        a.addEventListener("click", (e) => {
          e.preventDefault();
          history.replaceState(null, "", `#${a.dataset.tab}`);
          handleHashChange();
        });
      });
      if (!location.hash) location.hash = "#latest";
      handleHashChange();
      window.addEventListener("hashchange", handleHashChange);
      injectStructuredData(events);
    })();

    /* ============== 8) JSON-LDï¼ˆSEOï¼›ä¸è¼¸å‡º imageï¼‰ ============== */
    function injectStructuredData(items) {
      const upcoming = items.filter(i => (i.type || "").trim() === "upcoming");
      const ld = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "æ–°ç¾©å’Œæ­ŒåŠ‡åœ˜ æ´»å‹•åˆ—è¡¨",
        "itemListElement": upcoming.map((e, idx) => ({
          "@type": "ListItem",
          "position": idx + 1,
          "item": {
            "@type": "Event",
            "name": e.title,
            "startDate": e.dateStart,
            ...(e.dateEnd ? {"endDate": e.dateEnd} : {}),
            "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
            "location": {"@type": "Place","name": e.location || "","address": e.city || ""},
            "description": e.summary || "",
            ...(e.ticketUrl ? {"offers": {"@type": "Offer","url": e.ticketUrl,"availability": "https://schema.org/InStock"}} : {})
          }
        }))
      };
      const script = document.createElement("script");
      script.type = "application/ld+json";
      script.textContent = JSON.stringify(ld, null, 2);
      document.head.appendChild(script);
    }
  </script>
</body>
</html>
